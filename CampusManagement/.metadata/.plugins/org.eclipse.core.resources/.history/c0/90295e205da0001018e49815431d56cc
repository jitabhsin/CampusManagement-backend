package edu.infosys.lostAndFoundApplication.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import edu.infosys.lostAndFoundApplication.bean.LostFoundItem;
import edu.infosys.lostAndFoundApplication.dao.LostFoundItemDao;
import edu.infosys.lostAndFoundApplication.service.CampusUserService;

@RestController
@RequestMapping("/lost-found/")
@CrossOrigin(origins = "http://localhost:3939")
public class LostFoundItemController {

    @Autowired
    private LostFoundItemDao lostFoundItemDao;

    @Autowired
    private CampusUserService service;

    @GetMapping("/item")
    public List<LostFoundItem> getAllItems() {
        return lostFoundItemDao.findAll();
    }

    @PostMapping("/item")
    public void lostItemSubmission(@RequestBody LostFoundItem lostItem) {
        lostItem.setFoundDate(null);
        lostFoundItemDao.save(lostItem);
    }

    @PutMapping("/item")
    public void foundItemSubmission(@RequestBody LostFoundItem lostItem) {
        lostFoundItemDao.save(lostItem);
    }

    @GetMapping("/item/{id}")
    public LostFoundItem getItemById(@PathVariable Long id) {
        return lostFoundItemDao.findById(id);
    }

    @DeleteMapping("/item/{id}")
    public void deleteItemById(@PathVariable Long id) {
        lostFoundItemDao.deleteById(id);
    }

    @GetMapping("/id-gen")
    public Long itemIdGenerator() {
        return lostFoundItemDao.generateId();
    }

    @GetMapping("/not-found")
    public List<LostFoundItem> lostItemList() {
        return lostFoundItemDao.lostItemList();
    }

    @GetMapping("/found")
    public List<LostFoundItem> foundItemList() {
        return lostFoundItemDao.foundItemList();
    }

    @GetMapping("/lost")
    public List<LostFoundItem> lostItemListByUser() {
        String username = service.getUserId();
        String role = service.getRole();
        if ("admin".equalsIgnoreCase(role)) {
            return lostFoundItemDao.lostItemList();
        } else {
            return lostFoundItemDao.lostItemListByUser(username);
        }
    }

    @GetMapping("/lostfound")
    public List<LostFoundItem> foundItemListByUser() {
        String username = service.getUserId();
        String role = service.getRole();
        if ("admin".equalsIgnoreCase(role)) {
            return lostFoundItemDao.foundItemList();
        } else {
            return lostFoundItemDao.foundItemListByUser(username);
        }
    }
}
